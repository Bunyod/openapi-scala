openapi: 3.0.0

info:
  title: 'enfore Marketplace Registry API'
  version: "0.0.2"
  description: |
    This is a first design version of the enfore Marketplace API

paths:

  '/registry_entry':
    post:
      summary: Create a Registry Entry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterSupplierRequest'
#              oneOf:
#                - $ref: '#/components/schemas/RegisterSupplierRequest'
#                - $ref: '#/components/schemas/RegisterCustomerRequest'
      responses:
        200:
          description: Registry entry created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistryEntry' 
        400:
          description: Invalid request

  '/supplier-group':
    post:
      summary: Register a Supplier Group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterSupplierGroup'
      responses:
        200:
          description: Supplier Group Created
        400:
          description: Invalid request

  '/supplier':
    post:
      summary: Register a SubSupplier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterSubSupplier'
      responses:
        200:
          description: SubSupplier Created
        400:
          description: Invalid request

  '/customer':
    post:
      summary: Register a customer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCustomer'
      responses:
        200:
          description: Customer Created
        400:
          description: Invalid request

components:
  schemas:

    RegisterSupplierRequest:
      description: |
        Create a Supplier
      type: object
      properties:
        '@type':
          description: |
            Constant name of the enfore DataModel Type
          $ref: '#/components/schemas/RegistrySupplierRequestAnnotation'
        n4SupplierContactRef:
          type: string
      required:
        - '@type'
        - n4SupplierContactRef 

    RegisterCustomerRequest:
      description: |
        Create a Customer at a Supplier
      type: object
      properties:
        '@type':
          description: |
            Constant name of the enfore DataModel Type
          type: string
          enum: ['n4.marketplace.registry.internal.info.supplier.RegistryCustomerRequest']
        supplierCustomerId:
          type: string
        supplierGroupId:
          type: string
        subSupplierId:
          type: string
      required:
        - '@type'
        - supplierCustomerId
        - supplierGroupId
        - subSupplierId

    RegistryEntry:
      description: |
        An entry in ther Registry that represents a relationship between a customer, a supplier and an enfore Organization
      type: object
      properties:
        '@type':
          description: |
            Constant name of the enfore DataModel Type
          type: string
          enum: ['n4.coreservices.registry.RegistryEntry']
        supplierCustomerId:
          description: |
            ID of the Customer at the Supplier
          type: string
        supplierGroupId:
          description: |
            ID of the Supplier Group
          type: string
        subSupplierId:
          description: |
            ID of the subsupplier within the Supplier Group
          type: string
        n4SupplierContactRef:
          description: |
            enfore datamodel reference to the contact of the organization representing the supplier
          type: string
        supplierAdapterOrderEndpoint:
          description: |
            Supplier callback HTTP Endpoint for Purchase Order Submissions
          type: string
        credentials:
          description: |
            An opaque string that can store arbitrary information the supplier might need to persist between calls. Usually this would be 
            some identifiers or passwords needed for the customer to be properly identified in the Supplier's system.
          type: string
        whitelistedProductsOnly:
          description: |
            If this is true, the customer can only see products that have been whitelisted for them, not the entire Marketplace catalog.
          type: boolean
      required:
        - '@type'
        - supplierCustomerId 
        - supplierGroupId
        - subSupplierId
        - n4SupplierContactRef
        - supplierAdapterOrderEndpoint
        - credentials
        - whitelistedProductsOnly

    RegisterSupplierGroup:
      description: |
        Register a supplier group into the Marketplace
      type: object
      properties:
        '@type':
          description: |
            Constant name of the enfore DataModel Type
          type: string
          enum: ['n4.marketplace.registry.external.registration.edi.RegisterSupplierGroupEDIFormat']
        supplierGroupId:
          description: |
            ID of the Supplier Group
          type: string
        supplierAdapterPurchaseEndpoint:
          type: string
        supplierAdapterOnboardEndpoint:
          type: string
      required:
        - '@type'
        - supplierGroupId
        - supplierAdapterPurchaseEndpoint
        - supplierAdapterOnboardEndpoint

    RegisterSubSupplier:
      description: |
        Register A supplier into a supplier Group
      type: object
      properties:
        '@type':
          description: |
            Constant name of the enfore DataModel Type
          type: string
          enum: ['n4.marketplace.registry.external.registration.edi.RegisterSubSupplierEDIFormat']
        supplierGroupId:
          description: |
            ID of the Supplier Group
          type: string
        subSupplierId:
          description: |
            ID of the subsupplier within the Supplier Group
          type: string
        supplierInfo:
          $ref: '#/components/schemas/SupplierInfo'
      required:
        - '@type'
        - supplierGroupId
        - subSupplierId
        - supplierInfo

    SupplierInfo:
      type: object
      description: |
        User-facing information about the supplier
      properties:
        name:
          type: string
      required:
        - name

    RegistrySupplierRequestAnnotation:
      description: |
        Contains the annotation for fixed data type
      type: string
      enum:
        - n4.marketplace.registry.internal.info.supplier.RegistrySupplierRequest

    RegisterCustomer:
      description: |
        Register a customer. This creates a binding from the supplier notion of customer to the customer as an enfore organizations
      type: object
      properties:
        '@type':
          description: |
            Constant name of the enfore DataModel Type
          type: string
          enum: ['n4.marketplace.registry.external.registration.edi.RegisterSupplierCustomerEDIFormat']
        organizationId:
          type: string
        supplierGroupId:
          description: |
            ID of the Supplier Group
          type: string
        subSupplierId:
          description: |
            ID of the subsupplier within the Supplier Group
          type: string
        credentials: 
          description: |
            Some opaque string that can be stored here with the customer and then is sent along with requests to the adapters.
            This allows to store additional customer-identifying information along the customer id
          type: string
        supplierCustomerId:
          description: |
            ID of the Customer at the Supplier
          type: string
        whitelistedProductsOnly:
          description: |
            If this is true, the customer can only see products that have been whitelisted for them, not the entire Marketplace catalog.
          type: boolean
      required:
        - '@type'
        - organizationId 
        - supplierGroupId
        - subSupplierId
        - credentials
        - supplierCustomerId
        - whitelistedProductsOnly
